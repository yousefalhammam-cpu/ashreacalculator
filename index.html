<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>حاسبة تهوية وتكييف المستشفيات (ASHRAE 170)</title>
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(15,23,42,.55);
      --line: rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted: rgba(226,232,240,.72);
      --muted2: rgba(226,232,240,.55);
      --ok: rgba(34,197,94,.18);
      --warn: rgba(245,158,11,.18);
      --danger: rgba(239,68,68,.18);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "Segoe UI", Roboto, Arial;
      background: radial-gradient(900px 500px at 20% 0%, rgba(59,130,246,.22), transparent 60%),
                  radial-gradient(900px 500px at 80% 10%, rgba(16,185,129,.18), transparent 65%),
                  radial-gradient(900px 600px at 60% 90%, rgba(168,85,247,.18), transparent 60%),
                  var(--bg);
      color: var(--text);
      padding: 16px 14px 40px;
    }
    .container{ max-width: 920px; margin: 0 auto; }
    header{ display:flex; flex-direction:column; gap:10px; margin-bottom: 14px; }
    .titleRow{ display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap; }
    h1{ margin:0; font-size: 20px; line-height: 1.25; font-weight: 900; letter-spacing: .2px; }
    .subtitle{ margin:0; color: var(--muted); font-size: 13px; line-height: 1.6; max-width: 62ch; }
    .pillRow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-start; }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius: 999px; border:1px solid var(--line);
      background: rgba(15,23,42,.35); color: var(--muted);
      font-size: 12px; line-height: 1; white-space:nowrap;
    }
    .tag.danger{ background: var(--danger); border-color: rgba(239,68,68,.35); color:#fecaca;}
    .tag.warn{ background: var(--warn); border-color: rgba(245,158,11,.35); color:#fde68a;}
    .tag.ok{ background: var(--ok); border-color: rgba(34,197,94,.35); color:#bbf7d0;}

    .card{
      border:1px solid var(--line);
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      margin: 12px 0;
    }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width:680px){ .grid2{ grid-template-columns: 1fr; } }

    label{ display:block; font-size: 12px; color: var(--muted); margin: 0 0 6px; }

    input, select{
      width:100%;
      border:1px solid var(--line);
      background: rgba(2,6,23,.35);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 14px;
      outline: none;
      font-size: 14px;
    }
    input::placeholder{ color: rgba(226,232,240,.45); }

    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    @media (max-width:520px){ .row{ grid-template-columns: 1fr; } }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .btn{
      appearance:none; border:1px solid var(--line);
      background: rgba(2,6,23,.35); color: var(--text);
      padding: 11px 14px; border-radius: 14px; cursor:pointer;
      font-weight: 800; font-size: 14px;
    }
    .btn.primary{ background: rgba(59,130,246,.20); border-color: rgba(59,130,246,.35); }
    .btn.danger{ background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.35); }
    .btn:active{ transform: translateY(1px); }

    .mutedLine{ font-size: 12px; color: var(--muted2); line-height: 1.6; margin-top: 6px; }
    .sep{ border:0; border-top:1px solid var(--line); margin: 12px 0; }

    .summary{
      display:grid; grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px; margin-top: 10px;
    }
    @media (max-width:680px){ .summary{ grid-template-columns: 1fr 1fr; } }
    @media (max-width:420px){ .summary{ grid-template-columns: 1fr; } }
    .sumBox{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background: rgba(2,6,23,.25);
    }
    .sumK{ font-size:12px; color: var(--muted); margin-bottom: 6px; }
    .sumV{ font-size: 18px; font-weight: 900; }

    #list{ display:flex; flex-direction:column; gap: 12px; margin-top: 12px; }
    .roomCard{
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(2,6,23,.20);
      padding: 14px;
    }
    .roomHead{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; flex-wrap:wrap; }
    .roomHead h3{ margin:0; font-size: 16px; font-weight: 950; letter-spacing: .2px; }
    .sub{ margin-top: 6px; color: var(--muted); font-size: 12px; line-height: 1.5; }

    .metrics{
      display:grid; grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px; margin-top: 12px;
    }
    @media (max-width:820px){ .metrics{ grid-template-columns: 1fr 1fr; } }
    @media (max-width:420px){ .metrics{ grid-template-columns: 1fr; } }
    .metric{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(2,6,23,.18);
      min-height: 62px;
      display:flex; flex-direction:column; justify-content:space-between;
    }
    .metric .k{ font-size: 12px; color: var(--muted); margin-bottom: 8px; }
    .metric .v{ font-size: 18px; font-weight: 950; }

    .footer{
      margin-top: 16px;
      text-align:center;
      color: rgba(226,232,240,.6);
      font-size: 12px;
      line-height: 1.7;
    }

    /* ===== KIMO DASHBOARD ===== */
    .kimoWrap{
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      background: rgba(15,23,42,.55);
      backdrop-filter: blur(10px);
      margin: 12px 0 12px;
      box-shadow: var(--shadow);
    }
    .kimoTop{ display:flex; gap:12px; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; margin-bottom: 10px; }
    .kimoTitle{ display:flex; flex-direction:column; gap:6px; }
    .kimoBadge{ display:inline-flex; width: fit-content; padding:6px 10px; border-radius:999px; border:1px solid var(--line); font-size:12px; opacity:.9; }
    .kimoRoom{ font-size:16px; font-weight:900; letter-spacing:.2px; }
    .kimoMeta{ display:flex; gap:12px; align-items:flex-start; }
    .kimoClock{ border:1px solid var(--line); border-radius:12px; padding:8px 10px; font-size:12px; text-align:right; min-width: 120px; }
    .kimoMode{ border:1px solid var(--line); border-radius:12px; padding:8px 10px; min-width: 150px; }
    .kimoModeLabel{ font-size:12px; opacity:.8; margin-bottom:4px;}
    .kimoModeValue{ font-size:16px; font-weight:950; }
    .kimoGrid{ display:grid; gap:10px; }
    .kimoRow{ display:flex; justify-content: space-between; align-items:center; padding:10px 12px; border:1px solid var(--line); border-radius:14px; background: rgba(2,6,23,.18); }
    .kimoCh{ font-size:13px; opacity:.85; }
    .kimoVal{ font-size:18px; font-weight:950; display:flex; gap:6px; align-items: baseline; }
    .kimoUnit{ font-size:12px; opacity:.75; }
    .kimoBottom{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; margin-top:10px; }
    .kimoMini{ border:1px solid var(--line); border-radius:14px; padding:10px 12px; background: rgba(2,6,23,.18); }
    .kimoMiniK{ font-size:12px; opacity:.8; margin-bottom:6px; }
    .kimoMiniV{ font-size:16px; font-weight:950; }
    @media (max-width:420px){
      .kimoBottom{ grid-template-columns: 1fr; }
      .kimoMeta{ width:100%; justify-content: space-between; }
    }

    /* AI Advisor */
    .aiBox{
      margin-top:10px;
      border:1px dashed rgba(148,163,184,.35);
      border-radius: 16px;
      padding: 12px;
      background: rgba(2,6,23,.18);
    }
    .aiTitle{ font-weight:950; font-size:12px; opacity:.9; margin-bottom:8px; }
  </style>
</head>

<body>
  <div class="container">

    <header>
      <div class="titleRow">
        <div>
          <h1>حاسبة تهوية وتكييف المستشفيات (ASHRAE 170)</h1>
          <p class="subtitle">
            إدخل نوع الغرفة + حجمها (m³) لتحصل على ACH/CFM/Exhaust/TR (تقديري)، مع مقارنة Design vs Measured وتوصيات ذكية.
          </p>
        </div>
        <div class="pillRow">
          <span class="tag">Hospital HVAC • PWA</span>
          <span class="tag">Version: <b>2.0</b></span>
        </div>
      </div>

      <div class="pillRow">
        <span class="tag" id="statusTag">Loading…</span>
        <span class="tag" id="countTag">Rooms: 0</span>
      </div>
    </header>

    <!-- KIMO-style Dashboard -->
    <section class="kimoWrap">
      <div class="kimoTop">
        <div class="kimoTitle">
          <div class="kimoBadge">KIMO • Style</div>
          <div class="kimoRoom" id="kimoRoomName">—</div>
        </div>
        <div class="kimoMeta">
          <div class="kimoClock">
            <div id="kimoTime">—</div>
            <div id="kimoDate">—</div>
          </div>
          <div class="kimoMode">
            <div class="kimoModeLabel">Room Mode</div>
            <div class="kimoModeValue" id="kimoMode">—</div>
          </div>
        </div>
      </div>

      <div class="kimoGrid">
        <div class="kimoRow">
          <div class="kimoCh">C1: Pressure</div>
          <div class="kimoVal"><span id="kimoPa">—</span> <span class="kimoUnit">Pa</span></div>
        </div>
        <div class="kimoRow">
          <div class="kimoCh">C2: Temperature</div>
          <div class="kimoVal"><span id="kimoTemp">—</span> <span class="kimoUnit">°C</span></div>
        </div>
        <div class="kimoRow">
          <div class="kimoCh">C3: Humidity</div>
          <div class="kimoVal"><span id="kimoRh">—</span> <span class="kimoUnit">%RH</span></div>
        </div>
        <div class="kimoRow">
          <div class="kimoCh">C4: Air Flow</div>
          <div class="kimoVal"><span id="kimoCfm">—</span> <span class="kimoUnit">CFM</span></div>
        </div>
        <div class="kimoRow">
          <div class="kimoCh">C5: Air Change</div>
          <div class="kimoVal"><span id="kimoAch">—</span> <span class="kimoUnit">ACH</span></div>
        </div>
      </div>

      <div class="kimoBottom">
        <div class="kimoMini">
          <div class="kimoMiniK">Design Total ACH</div>
          <div class="kimoMiniV" id="kimoRefAch">—</div>
        </div>
        <div class="kimoMini">
          <div class="kimoMiniK">ΔACH</div>
          <div class="kimoMiniV" id="kimoDelta">—</div>
        </div>
        <div class="kimoMini">
          <div class="kimoMiniK">Status</div>
          <div class="kimoMiniV" id="kimoStatus">—</div>
        </div>
      </div>
    </section>

    <!-- Inputs -->
    <section class="card">
      <div class="grid2">
        <div>
          <label for="roomType">نوع الغرفة (ASHRAE)</label>
          <select id="roomType"></select>
        </div>
        <div>
          <label for="roomName">اسم الغرفة (اختياري)</label>
          <input id="roomName" type="text" placeholder="مثال: Isolation Room 1.3.2.1" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>
          <label for="volumeM3">حجم الغرفة (m³)</label>
          <input id="volumeM3" type="number" min="0" step="0.01" placeholder="مثال: 60" />
        </div>
        <div>
          <label for="offsetPct">Pressure Offset (%)</label>
          <input id="offsetPct" type="number" min="0" step="0.1" value="10" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>
          <label for="thumb">Rule of Thumb (CFM/TR)</label>
          <select id="thumb">
            <option value="350">350</option>
            <option value="400" selected>400</option>
            <option value="450">450</option>
          </select>
        </div>
        <div>
          <label for="oaOverride">Outdoor Air Override (ACH) — اختياري</label>
          <input id="oaOverride" type="number" min="0" step="0.1" placeholder="اتركه فاضي للتطبيق المرجع" />
        </div>
      </div>

      <hr class="sep">

      <div class="tag" style="margin-bottom:8px;">Measured (اختياري) — قراءة ميدانية لنفس الغرفة</div>

      <div class="row">
        <div>
          <label for="mCfm">Measured Airflow (CFM)</label>
          <input id="mCfm" type="number" min="0" step="1" placeholder="مثال: 313" />
        </div>
        <div>
          <label for="mPa">Measured Pressure (Pa)</label>
          <input id="mPa" type="number" step="0.1" placeholder="مثال: -10" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>
          <label for="mTemp">Measured Temp (°C)</label>
          <input id="mTemp" type="number" step="0.1" placeholder="مثال: 20.6" />
        </div>
        <div>
          <label for="mRh">Measured RH (%)</label>
          <input id="mRh" type="number" min="0" max="100" step="0.1" placeholder="مثال: 25.6" />
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="addBtn">+ إضافة غرفة</button>
        <button class="btn" id="exportBtn">تصدير Excel (CSV)</button>
        <button class="btn danger" id="clearBtn">مسح الكل</button>
      </div>

      <div class="mutedLine">
        “AI Advisor” هنا يعتمد قواعد ذكية داخل المتصفح (مجاني) لمقارنة Design vs Measured وتقديم توصيات.
      </div>
    </section>

    <!-- Summary -->
    <section class="card">
      <div class="pillRow" style="margin-bottom:8px;">
        <span class="tag">الإجماليات (Totals)</span>
      </div>

      <div class="summary">
        <div class="sumBox">
          <div class="sumK">Total Supply (CFM)</div>
          <div class="sumV" id="sumSupply">—</div>
        </div>
        <div class="sumBox">
          <div class="sumK">Total Outdoor (CFM)</div>
          <div class="sumV" id="sumOA">—</div>
        </div>
        <div class="sumBox">
          <div class="sumK">Total Exhaust (CFM)</div>
          <div class="sumV" id="sumExh">—</div>
        </div>
        <div class="sumBox">
          <div class="sumK">Total TR (est)</div>
          <div class="sumV" id="sumTR">—</div>
        </div>
      </div>
    </section>

    <!-- List -->
    <section class="card">
      <div id="emptyState" class="mutedLine">
        ما أضفت أي غرفة لسه — ابدأ بإضافة غرفة من الأعلى.
      </div>
      <div id="list"></div>
    </section>

    <div class="footer">
      الحقوق محفوظة © <b>م. يوسف الهمام</b> — <b>yousef.alhammam@live</b><br/>
      هذه الأداة للاستخدام الهندسي المرجعي والتقديري.
    </div>

  </div>

  <script src="app.js"></script>
</body>
</html>